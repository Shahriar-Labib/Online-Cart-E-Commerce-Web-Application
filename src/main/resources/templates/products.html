<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::layout(~{::section})}">
<head>
    <meta charset="ISO-8859-1">
    <title>Products</title>

    <style>

        /* Search Bar */
        .search-section {
            background: linear-gradient(45deg, #0c8c47, #0f7f40);
            padding: 50px 0;
            border-radius: 0 0 20px 20px;
        }

        .search-input {
            border-radius: 10px;
            padding: 12px;
            border: none;
            outline: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .search-btn {
            border-radius: 10px;
            padding: 12px;
            font-weight: 600;
            background: white !important;
            color: #0d6f3c !important;
        }

        .search-btn:hover {
            background: #e6e6e6 !important;
        }


        /* Filter Sidebar */
        .filter-card {
            border-radius: 20px;
            border: none;
        }

        .list-group-item {
            padding: 12px;
            font-weight: 500;
            border: none;
            border-radius: 10px;
            margin-bottom: 5px;
        }

        .list-group-item:hover {
            background: #e8ffe8;
        }

        .list-group-item.active {
            background: #0c8c47 !important;
            border-color: #0c8c47 !important;
        }


        /* Product Cards */
        .product-card {
            border-radius: 18px;
            transition: .3s ease;
            border: none !important;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(0,0,0,0.15);
        }

        .product-img {
            width: 100%;
            height: 170px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 10px;
            background: #f4f4f4;
        }

        .price-box span {
            font-size: 17px;
        }


        /* Pagination */
        .pagination .page-link {
            border-radius: 8px;
            margin: 0 4px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .pagination .active .page-link {
            background: #0c8c47 !important;
            border-color: #0c8c47 !important;
        }

        .pagination .page-item.disabled .page-link {
            background: #e6e6e6;
        }

        .search-wrapper {
            display: flex;
            gap: 10px;
            width: 100%;
            align-items: center;
        }

        .search-wrapper input {
            flex: 1;
            min-width: 0;
        }

        .search-btn {
            white-space: nowrap;
        }

        .input-group .form-control {
                border-top-right-radius: 0.4rem !important;
                border-bottom-right-radius: 0.4rem !important;
                margin-right: 6px;
            }

            .input-group button {
                border-radius: 0.4rem !important;
            }

    </style>
</head>

<body>
<section>

    <!-- Search Section -->
    <div class="container-fluid bg-success p-5 mt-5">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <form action="/products" method="get">
                    <div class="input-group">
                        <input type="text" class="form-control" name="ch" placeholder="Search products...">
                        <button class="btn btn-light text-dark" type="submit">
                            <i class="fa-solid fa-magnifying-glass"></i> Search
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="container-fluid mt-4">
        <div class="row">

            <!-- Sidebar -->
            <div class="col-md-2 p-0">
                <div class="card shadow-sm filter-card p-0 mb-5 bg-body-tertiary rounded">
                    <div class="card-body">
                        <p class="fs-4 fw-bold mb-3">Categories</p>

                        <div class="list-group">

                            <a href="/products"
                               th:classappend="${paramValue==''} ? 'active':''"
                               class="list-group-item list-group-item-action">
                                All
                            </a>

                            <a th:each="c:${categories}"
                               th:href="@{'/products?category='+${c.name}}"
                               th:classappend="${paramValue == c.name} ? 'active':''"
                               class="list-group-item list-group-item-action">
                                [[${c.name}]]
                            </a>

                        </div>
                    </div>
                </div>
            </div>


            <!-- Product Area -->
            <div class="col-md-10">

                <div class="card shadow-sm p-4 mb-5 bg-body-tertiary rounded">
                    <p class="fs-3 text-center fw-bold">Products</p>

                    <div class="row mt-4">

                        <!-- If products exist -->
                        <th:block th:if="${productsSize >0}">

                            <div class="col-md-3 mb-4" th:each="p:${products}">

                                <div class="card product-card p-3 shadow-sm">
                                    <img th:src="@{'/img/product_img/'+${p.image}}"
                                         class="product-img">

                                    <p class="fs-5 fw-semibold text-center mt-2">
                                        [[${p.title}]]
                                    </p>

                                    <div class="price-box text-center mt-2">
                                        <span class="fw-bold text-dark">&#8377; [[${p.discountPrice}]]</span>
                                        <br>
                                        <span class="text-decoration-line-through text-secondary">&#8377; [[${p.price}]]</span>
                                        <span class="text-success fw-bold">[[${p.discount}]]% off</span>
                                    </div>

                                    <div class="text-center mt-3">
                                        <a th:href="@{'/product/'+${p.id}}" class="btn btn-success px-4">
                                            View Details
                                        </a>
                                    </div>

                                </div>

                            </div>

                        </th:block>


                        <!-- If no products -->
                        <th:block th:unless="${productsSize >0}">
                            <p class="fs-4 text-center text-danger mt-4">Product not available</p>
                        </th:block>

                    </div>
                </div>


                <!-- Pagination + info -->
                <div class="row mb-4">

                    <div class="col-md-4 fs-5">
                        Total Products : [[${totalElements}]]
                    </div>

                    <div class="col-md-6">

                        <th:block th:if="${productsSize >0}">
                            <nav aria-label="Page navigation">
                                <ul class="pagination">

                                    <!-- Previous -->
                                    <li class="page-item"
                                        th:classappend="${isFirst} ? 'disabled':''">
                                        <a class="page-link"
                                           th:href="@{'/products?pageNo='+${pageNo-1}}">&laquo;</a>
                                    </li>

                                    <!-- Numbers -->
                                    <li th:each="i:${#numbers.sequence(1,totalPages)}"
                                        class="page-item"
                                        th:classappend="${pageNo+1==i}?'active':''">
                                        <a class="page-link"
                                           th:href="@{'/products?pageNo='+${i-1}}">[[${i}]]</a>
                                    </li>

                                    <!-- Next -->
                                    <li class="page-item"
                                        th:classappend="${isLast} ? 'disabled':''">
                                        <a class="page-link"
                                           th:href="@{'/products?pageNo='+${pageNo+1}}">&raquo;</a>
                                    </li>

                                </ul>
                            </nav>
                        </th:block>

                    </div>

                </div>

            </div>

        </div>
    </div>

</section>
</body>
</html>
